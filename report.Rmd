---
title: "Posible Title"
thanks: "Replication files are available on the author's Github account (https://github.com/MCV20/GLM-project.git). **Current version**: `r format(Sys.time(), '%B %d, %Y')`"
#subtitle: "Short title goes here!"
author:
- Amos Okutse$^1$
- Monica Colon-Vargas$^1$
- $^1$School of Public Health, Brown University, Providence, RI.
abstract: | 
  **Introduction:** hi
  
  **Objective:** hi
  **Methods:** hi
  
  **Results:** hi
  
  **Conclusion:** hi
  
  
  
  ***Keywords:*** *Obesity, *Pandemic*, *Health risk*, *Lower socioeconomic groups.*
keywords: "pandoc, r markdown, knitr"
#date: "  `r format(Sys.time(), '%d %B, %Y')` "
geometry: margin=1in
mainfont: cochineal
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
- \usepackage{fvextra}
- \usepackage{float}
- \usepackage{wrapfig}
- \usepackage{tabularx}
- \usepackage{amsmath}
- \usepackage{threeparttable} %used to fix table with notes
- \usepackage{float}
- \usepackage{graphicx}
- \usepackage{microtype}
- \usepackage{setspace}
- \usepackage[font=singlespacing]{caption} #can change font here for captions here!!
- \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines, commandchars=\\\{\}}
- \singlespacing
fontsize: 11pt
output:
  bookdown::pdf_document2:
    latex_engine: xelatex
    dev: cairo_pdf
    toc: false
    toc_depth: 4
    number_sections: false
    keep_md: false
link-citations: yes
colorlinks: yes
linkcolor: blue
urlcolor: blue
bibliography: references.bib
bibliostyle: bibtex
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE, 
                      fig.align="center")
```

```{r}
## Load libraries
library(naniar)
library(dplyr)
library(ggplot2)
library(corrplot)
library(caret)
library(tidymodels)
library(naivebayes)
library(gtsummary)
library(nnet)
library(coefplot)
library(ggpubr)
library(pROC)
library(MASS)
library(stargazer)
library(brant)
library(DescTools)
library(ordinalNet)
library(pomcheckr)
library(ROSE)
library(kableExtra)
theme_set(theme_minimal())
```


# Introduction

The World Health Organization (WHO) defines obesity as a chronic and intricate disease characterized by an accumulation of excess fat that poses significant health risks. This condition is not confined to isolated cases but has become alarmingly prevalent across numerous countries worldwide, warranting recognition as a global pandemic (CITE PAPER1). Among its many complications, obesity significantly elevates the risk of various health issues, including diabetes, fatty liver disease, hypertension, cardiovascular events like heart attacks and strokes, cognitive decline, joint ailments such as osteoarthritis, disrupted sleep patterns due to conditions like obstructive sleep apnea, and an increased susceptibility to certain types of cancer (CITE PAPER1). 

Literature suggests that the likelihood of obesity is influenced by a range of factors beyond individual characteristics, including demographic attributes, community infrastructure, socioeconomic conditions, and specific environmental factors within communities (CITE PAPER 2). In certain countries, particularly among lower socioeconomic groups, obesity rates have surged dramatically due to urbanization, shifts in diet and food availability, and reduced physical activity. This rise in obesity is linked to a significant increase in mortality from chronic diseases like type 2 diabetes, heart disease, and certain cancers, potentially shortening life expectancy by up to 20 years. Given the preventable nature of obesity and its associated health risks, early detection is crucial to mitigate the development of serious conditions such as cardiovascular issues, diabetes, and asthma. Obesity's complex origins involve various factors including socioeconomic status, occupation, and lifestyle habits like smoking and physical activity levels. Physical activity and eating habits are key in preventing obesity, as it primarily stems from an imbalance between calories consumed and expended. Weight loss typically involves reducing calorie intake, increasing energy expenditure, or both. When individuals consume more energy than needed, the excess is stored as fat, leading to obesity. Therefore, maintaining a healthy weight relies on a balanced diet and regular physical activity. (CITE PAPER3) 


This work is centered in identifying determinants associated with obesity, with particular emphasis on exploring the interplay between socioeconomic indicators and lifestyle behaviors. In Latin American obesity rates have reached alarming levels, posing serious health risks and placing a substantial burden on healthcare systems CITE(paper4). Therefore this work will address the global health issue of obesity, with a specific focus on the diverse populations of Mexico, Peru, and Colombia. By examining individuals' eating habits and physical condition, this research aims to understand the factors contributing to obesity prevalence in these regions and understand the underlying mechanisms driving the escalating rates of obesity. 


# Methodology

### Data

```{r}
## Load data
dat <- read.csv("ObesityDataSet_raw_and_data_sinthetic.csv")
dat <- dat[1:498,] #take original data before SMOTE
```


The dataset, accessible online at the UC Irvine Machine Learning Repository, includes information pertinent to estimating obesity levels among $(n=498)$ individuals aged 14 to 61 hailing from Mexico, Peru, and Colombia. Collected via a web-based survey administered to anonymous respondents, the dataset comprises 17 attributes and was available online for a duration of 30 days. Data collection involved posing questions as delineated in Table 1, which also details the variables under study and the methodology employed in the data collection process.

\begin{table}
\footnotesize
\centering
\caption{Variable Description}
\label{vardes}
\begin{tabularx}{\textwidth}{@{}lXX@{}}
\toprule
Variable & Description & Values\\
\addlinespace
\midrule
\texttt{Nobeyesdad} & Obesity Level & Insufficient/Normal ObesityI/ObesityII ObesityIII/OverweightI/OverweightII\\
\addlinespace
\midrule
\texttt{Gender} & What is your gender? & Female/Male\\
\addlinespace
\midrule
\texttt{Age} & What is your age? & Numeric Value\\
\addlinespace
\midrule
\texttt{Height} & What is your height? & Numeric Value (m)\\
\addlinespace
\midrule
\texttt{Weight} & What is your weight? & Numeric Value (kg)\\
\addlinespace
\midrule
\scriptsize{\verb+family_history_with_overweight+} &Has a family member suffered or suffers from overweight? & Yes/No\\
\addlinespace
\midrule
\texttt{FAVC} & Do you eat high caloric food frequently? & Yes/No\\
\addlinespace
\midrule
\texttt{FCVC} & Do you usually eat vegetables in your meals? & Never/Sometimes/Always\\
\addlinespace
\midrule
\texttt{NCP} & How many main meals do you have daily? & Numeric Value\\
\addlinespace
\midrule
\texttt{CAEC} & Do you eat any food between meals? & No/Sometimes/Frequently Always\\
\addlinespace
\midrule
\texttt{Smoker} & Do you smoke & Yes/No\\
\addlinespace
\midrule
\texttt{CH20} &How much water do you drink daily & Numeric Value\\
\addlinespace
\midrule
\texttt{SCC} & Do you monitor the calories you eat daily & Yes/No\\
\addlinespace
\midrule
\texttt{FAF} & How often do you do physical activity & Numeric Value\\
\addlinespace
\midrule
\texttt{TUE} & How much time do you use technological devices such as cell phone, videogames, television, computer and others? & Numeric Value\\
\addlinespace
\midrule
\texttt{CALC} &How often do you drink alcohol & Never/Sometimes/ Frequently/Always\\
\addlinespace
\midrule
\texttt{MTRANS} & Which transportation do you usually use & Automobile/Motorbike Bike/Public/Walking\\
\addlinespace
\bottomrule
\end{tabularx}
\end{table}


### Data Pre-processing
Given the relatively modest sample size of our dataset, we anticipate potential challenges in conducting robust analyses. Our outcome variables comprise seven distinct levels, encompassing three tiers of obesity (Type I, II, III), two tiers of overweight (I, II), as well as normal weight and underweight categories. However, certain categories contain a limited number of individuals, necessitating the consolidation of some for better statistical reliability. Accordingly, we introduce a novel class termed "Obese," which consolidates the three levels of obesity, alongside a separate class denoted as "Overweight," housing the two levels thereof, while retaining the remaining categories unchanged. Furthermore, certain categories within the covariates exhibited minimal representation, with some even lacking individuals in certain categories. Consequently, we undertook additional aggregation of these classes. For instance, within the alcohol consumption variable, we combined the "always" and "frequently" classes into a singular category. Similarly, in the transportation variable, we merged "motorbike" and "automobile" into a consolidated class termed "motor vehicle," while amalgamating "walking" and "bike" into a unified category. 

```{r}
## Data Preprocessing (covariates)
dat$CALC[dat$CALC == "Always"] <- "Frequently"
dat$CAEC[dat$CAEC == "Always"] <- "Frequently"
dat$MTRANS[dat$MTRANS == "Motorbike"] <- "Motor_Vehicle"
dat$MTRANS[dat$MTRANS == "Automobile"] <- "Motor_Vehicle"
dat$MTRANS[dat$MTRANS == "Bike"] <- "Walking/Bike"
dat$MTRANS[dat$MTRANS == "Walking"] <- "Walking/Bike"

dat$NObeyesdad <- ifelse(dat$NObeyesdad %in% c("Obesity_Type_I", "Obesity_Type_II", "Obesity_Type_III"), "Obese", dat$NObeyesdad)
dat$NObeyesdad <- ifelse(dat$NObeyesdad %in% c("Overweight_Level_I", "Overweight_Level_II"), "Overweight", dat$NObeyesdad)
dat$NObeyesdad[dat$NObeyesdad == "Insufficient_Weight"] <- "Underweight"

## Factor variables
dat <- dat %>%
  mutate_if(is.character, as.factor)

dat <- dat %>% mutate(
  FCVC = factor(FCVC),
  NCP = factor(NCP),
  CH2O = factor(CH2O),
  FAF = factor(FAF),
  TUE = factor(TUE)
)

## Remove weight variable and rename fam history
dat <- dat %>% dplyr::select(-Weight)
dat <- dat %>% rename(fam_hist = family_history_with_overweight)

```


### Statistical Modeling

Since the outcome variable exhibits an ordinal nature, where the categories can be ordered as underweight < normal < overweight < obese, we opted for a modeling approach suited to such data characteristics. Specifically, we employed the generalized linear model framework, fitting a proportional odds model. This modeling technique allows us to account for the ordinal nature of the outcome variable and the inherent ordering of its categories. By utilizing the proportional odds model, we can assess the relationship between the predictors and the ordinal outcome variable while accommodating the cumulative nature of the categories. 


### Variable Selection  
In light of the considerable number of variables present within the dataset, an approach to variable selection opted. To this end, we employed two distinct methodologies for variable selection. Primarily, variables were selected based on their significance as determined by p-values derived from the proportional odds model. Additionally, we conducted variable selection utilizing a proportional odds model with lasso penalization, a technique that inherently incorporates variable selection by penalizing less influential predictors. Subsequently, interactions among selected variables were explored, and the resultant models were meticulously compared to discern the most parsimonious and informative model structure. 

### Class Imbalance
Given the class imbalance within the outcome variable, we  address this issue by employing an upsampling technique. The goal is to decrease the disparity by augmenting the instances of minority classes to achieve parity with the majority class, thereby fostering a more balanced representation across all categories. Subsequently, within this augmented dataset, we applied the same two variable selection techniques previously described. This comprehensive approach ensures that the variable selection procedures are conducted on a dataset that reflects a more equitable distribution of observations across the various outcome categories, thereby mitigating potential biases and bolstering the reliability of the ensuing models. We additionally proceed to fit an additional model using the augmented dataset,incorporating solely those covariates that demonstrated statistical significance within the original dataset.

### Model Comparisons
The majority of models analyzed in this study were nested, with assessments primarily relying on information criteria such as the Akaike Information Criteria (AIC) and Bayesian Information Criteria (BIC). Notably, the BIC was preferred over the AIC due to its heightened penalty with larger sample sizes, leading to more stringent significance thresholds CITE(BIC). Model comparisons were conducted using the likelihood ratio test (LRT), aimed at examining competing models by testing the null hypothesis that the simpler and more complex models are equally effective. Specifically, this test assesses whether the additional parameters in the larger model significantly improve fit, implying that their effect sizes are statistically indistinguishable from zero.



# Results

### Descriptive Statistics

```{r}
## Summary Statistics
dat %>% tbl_summary(digits = list(everything() ~ c(2)),
                    statistic = list(all_continuous() ~ "{mean} ({sd})"),
                    by = NObeyesdad,
                    missing = "no",
                    label = list(
                      fam_hist ~"Family history overweight", 
                      FAVC ~ "High-calorie food consumption",
                      FCVC ~ "Number of meals veggie consumption",
                      NCP ~ "Daily main meals",
                      CAEC ~ "Eating between meals",
                      SMOKE ~ "Smoke",
                      CH2O ~ "Water Intake (L)",
                      SCC ~ "Calorie intake monitoring",
                      FAF ~ "Frequency of days of physical activity (wk)",
                      TUE ~ "Technology use time",
                      CALC ~ "Frequency of alchohol intake",
                      MTRANS ~ "Transportation"))%>%
  add_overall() %>% 
  bold_labels() %>%
  as_kable_extra(booktabs = TRUE, caption = "Summary Statistic Stratified by Outcome Category") %>% 
  kableExtra::kable_styling(latex_options = "scale_down")

```

Table 2 presents an overview of participant characteristics stratified by each outcome category.  Notably, the distribution across categories reveals a significant class imbalance, with only 34 participants categorized as underweight compared to 64 classified as obese. Conversely, the overweight category encompasses 116 participants, with the highest representation observed within the normal weight classification.


Within the subset of 64 obese participants, 53 (86.80%) individuals  exhibit familial overweight history, whereas among the underweight subset, 16 (47.06%) individuals demonstrate a similar familial predisposition.
Regarding dietary habits, individuals categorized as normal weight exhibit the highest prevalence of high-caloric food consumption, followed sequentially by obese, overweight, and underweight counterparts. Additionally, observing the frequency of vegetable consumption, we can see 55.88% of underweight participants consuming vegetables in all three main meals, while 59% of obese and overweight individuals consume vegetables in two main meals. Meal frequency reveals that most participants consume three daily main meals, while a minority consumes only one daily meal. Moreover, between-meal eating habits are prevalent across all weight categories, with few individuals abstaining from between-meal consumption. Remarkably, a significant proportion (52.95%) of underweight participants report frequent between-meal snacking. Hydration patterns among participants indicate a consistent consumption of approximately 2-3 liters of water daily. Public transportation emerges as the preferred mode of transportation among participants. Furthermore, physical activity engagement varies across weight categories, with 45.9% of obese individuals reporting no weekly physical activity.





### Model Results

### Model Diagnostics

# Discussion

# Code Appendix
```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE, include=TRUE}
```

